)
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/split_5_miseq/",
output_folder = "testing_outputs",
fastq_path = "../fastq/",
)
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "testing_outputs",
fastq_path = "../fastq/",
)
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
devtools::document()
devtools::load_all()
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
sce <- readRDS("../testing_outputs/split_5_miseq/filtered/sce_rds_objects/split_5_miseq_sce_filtered.rds")
sce
table(sce$sub_lib_id)
table(sce$sample_id)
table(sce$well_indexes)
devtools::load_all()
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
sce_sub <- readRDS("../testing_outputs/split_5_miseq/unfiltered/sce_rds_objects/split_5_miseq_Frozen_sce_unfiltered.rds")
table(sce_sub$sample_id)
samples <- unique(sce$sample_id)
samples
idx <- which(sce_split$sample_id == samples[1])
idx <- which(sce$sample_id == samples[1])
idx
length(sce$sample_id)
sce_sub <- sce[j=idx]
sce_sub
sce_sub <- sce[,idx]
sce_sub
table(sce_sub$sample_id)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
well_locs <- sce$well_indexes
stringr::str_split(well_locs, pattern = "_")
well_locs_list <- stringr::str_split(well_locs, pattern = "_")
rt_locs <- sapply(well_locs_list, "[[", 1)
rt_locs
rt_counts <- table(rt_locs)
rt_counts
# Convert into a x by x matrix for plotting
# RT is 4x12
rt_loc_mat <- matrix(rt_locs, nrow = 4, ncol = 12)
# Convert into a x by x matrix for plotting
# RT is 4x12
rt_loc_mat <- matrix(rt_counts, nrow = 4, ncol = 12)
names(rt_counts)
order(names(rt_counts))
order(as.numeric(names(rt_counts)))
rt_counts_ord <- rt_locs[order(as.numeric(names(rt_counts)))]
rt_counts_ord
# extract the counts, reorder and identify and fill in 0s
rt_counts <- as.dataframe(table(rt_locs))
# extract the counts, reorder and identify and fill in 0s
rt_counts <- as.data.frame(table(rt_locs))
rt_counts
?as.data.frame
# extract the counts, reorder and identify and fill in 0s
rt_counts <- as.data.frame(table(rt_locs), col.names = c("well_id", "count"))
rt_counts
colnames(rt_counts) <- c("well_id", "count")
rt_counts_ord <- rt_counts[order(rt_counts$rt_locs), ]
rt_counts_ord <- rt_counts[order(rt_counts$well_id), ]
rt_counts_ord
rt_counts$well_id <- numeric(rt_counts$well_id)
rt_counts$well_id <- as.numeric(rt_counts$well_id)
rt_counts_ord <- rt_counts[order(rt_counts$well_id), ]
rt_counts_ord
# Convert into a x by x matrix for plotting
# Create empty array and insert values
rt_vec <- rep(0, 48)
rt_vec
rt_vec[rt_counts$well_id] <- rt_counts$count
rt_vec
rt_counts
# extract the counts, reorder and identify and fill in 0s
rt_counts <- as.data.frame(table(rt_locs))
colnames(rt_counts) <- c("well_id", "count")
rt_counts$well_id <- as.numeric(rt_counts$well_id)
rt_counts
# extract the counts, reorder and identify and fill in 0s
rt_counts <- as.data.frame(table(rt_locs))
rt_counts
colnames(rt_counts) <- c("well_id", "count")
rt_counts
rt_counts$well_id <- as.numeric(rt_counts$well_id)
rt_counts
# extract the counts, reorder and identify and fill in 0s
rt_counts <- as.data.frame(table(rt_locs))
colnames(rt_counts) <- c("well_id", "count")
# Convert into a x by x matrix for plotting
# Create empty array and insert values
rt_vec <- rep(0, 48)
rt_vec[rt_counts$well_id] <- rt_counts$count
rt_vec
# extract the counts, reorder and identify and fill in 0s
rt_counts <- as.data.frame(table(rt_locs))
colnames(rt_counts) <- c("well_id", "count")
rt_counts
# Convert into a x by x matrix for plotting
# Create empty array and insert values
rt_vec <- rep(0, 48)
for(i in length(1:length(rt_counts$well_id))){
rt_vec[rt_counts$well_id[i]] <- rt_counts$count[i]
}
rt_vec
# Convert into a x by x matrix for plotting
# Create empty array and insert values
rt_vec <- rep(0, 48)
for(i in 1:length(length(rt_counts$well_id))){
rt_vec[rt_counts$well_id[i]] <- rt_counts$count[i]
}
rt_vec
# Convert into a x by x matrix for plotting
# Create empty array and insert values
rt_vec <- rep(0, 48)
for(i in 1:length(rt_counts$well_id)){
rt_vec[rt_counts$well_id[i]] <- rt_counts$count[i]
}
rt_vec
rt_counts$well_id[2]
# Extract count information by unzipping well info
well_locs <- sce_split$well_indexes
well_locs_list <- stringr::str_split(well_locs, pattern = "_")
rt_locs <- as.numeric(sapply(well_locs_list, "[[", 1))
# extract the counts, reorder and identify and fill in 0s
rt_counts <- as.data.frame(table(rt_locs))
colnames(rt_counts) <- c("well_id", "count")
rt_counts
typeof(rt_counts$well_id[1])
# Convert into a x by x matrix for plotting
# Create empty array and insert values
rt_vec <- rep(0, 48)
for(i in 1:length(rt_counts$well_id)){
rt_vec[rt_counts$well_id[i]] <- rt_counts$count[i]
}
rt_vec
# Convert into a x by x matrix for plotting
# Create empty array and insert values
rt_vec <- rep(0, 48)
for(i in 1:length(rt_counts$well_id)){
print(rt_counts$well_id[i])
rt_vec[rt_counts$well_id[i]] <- rt_counts$count[i]
}
# Convert into a x by x matrix for plotting
# Create empty array and insert values
# There is a really annoying type error here and the array is not assigning
rt_map <- data.frame(counts = rep(0, 48))
rt_map
for(i in 1:length(rt_counts$well_id)){
print(as.numeric(rt_counts$well_id[i]))
rt_vec[rt_counts$well_id[i]] <- rt_counts$count[i]
}
for(i in 1:length(rt_counts$well_id)){
rt_vec[as.numeric(rt_counts$well_id[i]),1] <- rt_counts$count[i]
}
for(i in 1:length(rt_counts$well_id)){
rt_vec[as.numeric(rt_counts$well_id[i]),1] <- rt_counts$count[i]
}
for(i in 1:length(rt_counts$well_id)){
rt_vec[as.numeric(rt_counts$well_id[i]),"counts"] <- rt_counts$count[i]
}
rt_map
for(i in 1:length(rt_counts$well_id)){
rt_vec[as.numeric(rt_counts$well_id[i]),"count"] <- rt_counts$count[i]
}
# Convert into a x by x matrix for plotting
# Create empty array and insert values
# There is a really annoying type error here and the array is not assigning
rt_map <- data.frame(counts = rep(0, 48))
for(i in 1:length(rt_counts$well_id)){
rt_map[as.numeric(rt_counts$well_id[i]),"count"] <- rt_counts$count[i]
}
rt_map
rt_counts
rt_map
length(rt_counts$well_id)
rt_locs
rt_layout <- seq(1:48)
rt_layout
table(rt_counts)[names(table(rt_counts)) == 4] # Count number of elements equal to certain value
table(rt_counts)[names(table(rt_counts)) == 10] # Count number of elements equal to certain value
table(rt_counts)
table(rt_counts)
table(rt_locs)[names(table(rt_locs)) == 10] # Count number of elements equal to certain value
table(rt_locs)[names(table(rt_locs)) == 8] # Count number of elements equal to certain value
# extract the counts, reorder and identify and fill in 0s
rt_counts_layout <- data.frame("well_position" = NULL, counts = NULL)
for(i in 1:48){
count = table(rt_locs)[names(table(rt_locs)) == 8] # Count number of elements equal to certain value
count_row = data.frame("well_position" = i, counts = coutn)
rt_counts_layout = cbind(rt_counts_layout, count_row)
}
for(i in 1:48){
count = table(rt_locs)[names(table(rt_locs)) == 8] # Count number of elements equal to certain value
count_row = data.frame("well_position" = i, counts = count)
rt_counts_layout = cbind(rt_counts_layout, count_row)
}
# extract the counts, reorder and identify and fill in 0s
rt_counts_layout <- data.frame("well_position" = NULL, counts = NULL)
for(i in 1:48){
count = table(rt_locs)[names(table(rt_locs)) == 8] # Count number of elements equal to certain value
count_row = data.frame("well_position" = i, counts = count)
rt_counts_layout = rbind(rt_counts_layout, count_row)
}
rt_counts_layout
# extract the counts, reorder and identify and fill in 0s
rt_counts_layout <- data.frame("well_position" = NULL, counts = NULL)
for(i in 1:48){
count = table(rt_locs)[names(table(rt_locs)) == i] # Count number of elements equal to certain value
count_row = data.frame("well_position" = i, counts = count)
rt_counts_layout = rbind(rt_counts_layout, count_row)
}
for(i in 1:48){
count = table(rt_locs)[names(table(rt_locs)) == i] # Count number of elements equal to certain value
print(i)
count_row = data.frame("well_position" = i, counts = count)
rt_counts_layout = rbind(rt_counts_layout, count_row)
}
# extract the counts, reorder and identify and fill in 0s
rt_counts_layout <- data.frame("well_position" = NULL, counts = NULL)
for(i in 1:48){
count = table(rt_locs)[names(table(rt_locs)) == i] # Count number of elements equal to certain value
if(identical(count, integer(0))){count = 0}
count_row = data.frame("well_position" = i, counts = count)
rt_counts_layout = rbind(rt_counts_layout, count_row)
}
identical(count, integer(0))
count = table(rt_locs)[names(table(rt_locs)) == 10] # Count number of elements equal to certain value
count
identical(count, integer(0))
length(count)
if(length(count == 0)){count = 0}
count
length(count)==0
if(length(count)==0){count = 0}
count
# extract the counts, reorder and identify and fill in 0s
rt_counts_layout <- data.frame("well_position" = NULL, counts = NULL)
for(i in 1:48){
count = table(rt_locs)[names(table(rt_locs)) == 10] # Count number of elements equal to certain value
if(length(count)==0){count = 0}
count_row = data.frame("well_position" = i, counts = count)
rt_counts_layout = rbind(rt_counts_layout, count_row)
}
rt_counts_layout
# extract the counts, reorder and identify and fill in 0s
rt_counts_layout <- data.frame("well_position" = NULL, counts = NULL)
for(i in 1:48){
count = table(rt_locs)[names(table(rt_locs)) == i] # Count number of elements equal to certain value
if(length(count)==0){count = 0}
count_row = data.frame("well_position" = i, counts = count)
rt_counts_layout = rbind(rt_counts_layout, count_row)
}
rt_counts_layout
# Convert into a x by x matrix for plotting
# RT is 4x12
rt_loc_mat <- matrix(rt_counts_layout$counts, nrow = 4, ncol = 12)
rt_loc_mat
# Convert into a x by x matrix for plotting
# RT is 4x12
rt_loc_mat <- matrix(rt_counts_layout$counts, nrow = 4, ncol = 12, byrow = TRUE)
rt_loc_mat
## For the heatmp, I need to know if there are any 0s -> send to NA
# Heatmap # Make square, Set heatmap limits
png(file=paste0(output_folder, '/',exp_name ,"/gplots/rt_barcoding_layout.png",
width = 240, height = 480, units = "px"))
Heatmap(rt_loc_mat,
cluster_columns = F,
cluster_rows = F,
col = pal_1,
rect_gp = gpar(col = "black", lwd = 1),
column_title = "RT Barcodes",
heatmap_legend_param = list(
title = "cell number")
)
library(ComplexHeatmap)
Heatmap(rt_loc_mat,
cluster_columns = F,
cluster_rows = F,
col = pal_1,
rect_gp = gpar(col = "black", lwd = 1),
column_title = "RT Barcodes",
heatmap_legend_param = list(
title = "cell number")
)
# Counts pal
pal_1 <- RColorBrewer::brewer.pal(9, "Greens")
Heatmap(rt_loc_mat,
cluster_columns = F,
cluster_rows = F,
col = pal_1,
rect_gp = gpar(col = "black", lwd = 1),
column_title = "RT Barcodes",
heatmap_legend_param = list(
title = "cell number")
)
Heatmap(rt_loc_mat,
cluster_columns = F,
cluster_rows = F,
col = pal_1,
rect_gp = gpar(col = "black", lwd = 1),
column_title = "RT Barcodes",
heatmap_legend_param = list(
title = "cell number")
)
# Counts pal
pal_1 <- colorRamp2(c(0,1,max(rt_counts_layout$counts)), c("gray", "floralwhite", "forestgreen"))
Heatmap(rt_loc_mat,
cluster_columns = F,
cluster_rows = F,
col = pal_1,
rect_gp = gpar(col = "black", lwd = 1),
column_title = "RT Barcodes",
heatmap_legend_param = list(
title = "cell number")
)
library(circlize)
# Counts pal
pal_1 <- colorRamp2(c(0,1,max(rt_counts_layout$counts)), c("gray", "floralwhite", "forestgreen"))
Heatmap(rt_loc_mat,
cluster_columns = F,
cluster_rows = F,
col = pal_1,
rect_gp = gpar(col = "black", lwd = 1),
column_title = "RT Barcodes",
heatmap_legend_param = list(
title = "cell number")
)
devtools::document()
devtools::load_all()
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
# Make the heatmaps
generate_barcoding_heatmaps(sce_split = sce_split_lab_filt,
output_folder = output_folder_abs,
exp_name = exp_name)
devtools::load_all()
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
devtools::load_all()
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
8*12
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
rt_locs
# Combine the UMI count with the locs
umi_rt <- data.frame(rt_id = rt_locs, umi = sce$total)
umi_rt
# Summarize median by id
med_umi_rt <- umi_rt %>% group_by(rt_id) %>% summarise(median(umi))
med_umi_rt
umi_rt <- data.frame(rt_id = rt_locs, umi = sce$total)
# Summarize median by id
med_umi_rt <- umi_rt %>% group_by(rt_id) %>% summarise(median(umi))
# extract the counts, reorder and identify and fill in 0s
rt_umi_layout <- data.frame("well_position" = NULL, counts = NULL)
for(i in 1:48){
umi_count = table(med_umi_rt$`median(umi)`)[names(table(med_umi_rt$`median(umi)`)) == i] # Count number of elements equal to certain value
if(length(umi_count)==0){umi_count = 0}
count_row = data.frame("well_position" = i, counts = umi_count)
rt_umi_layout = rbind(rt_umi_layout, count_row)
}
rt_umi_mat <- matrix(rt_umi_layout$counts, nrow = 4, ncol = 12, byrow = TRUE)
rt_umi_mat
med_umi_rt
med_umi_rt$`median(umi)`[5]
med_umi_rt$`median(umi)`[10]
which(med_umi_rt$rt_id == 10)
which(med_umi_rt$rt_id == 11)
# Combine the UMI count with the locs
umi_rt <- data.frame(rt_id = rt_locs, umi = sce$total)
# Summarize median by id
med_umi_rt <- umi_rt %>% group_by(rt_id) %>% summarise(median(umi))
# extract the counts, reorder and identify and fill in 0s
rt_umi_layout <- data.frame("well_position" = NULL, counts = NULL)
for(i in 1:48){
umi_count = med_umi_rt$`median(umi)`[which(med_umi_rt$rt_id == i)] # Count number of elements equal to certain value
if(length(umi_count)==0){umi_count = 0}
count_row = data.frame("well_position" = i, counts = umi_count)
rt_umi_layout = rbind(rt_umi_layout, count_row)
}
rt_umi_mat <- matrix(rt_umi_layout$counts, nrow = 4, ncol = 12, byrow = TRUE)
rt_umi_mat
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
load_all("../splitRtools/")
run_split_pipe(mode = 'single',
n_sublibs = 1,
data_folder = "~/Desktop/tape_lab/split_tools/test_data_sp_5_miseq/",
output_folder = "~/Desktop/tape_lab/split_tools/testing_outputs/",
fastq_path = "../fastq/",
)
